<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MyWebAR Style - Tap to Place</title>
    
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Lato:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* --- UI OVERLAY (HTML Buttons on top of AR) --- */
        #overlay {
            position: absolute; z-index: 100; width: 100%; height: 100%;
            pointer-events: none; /* Let touches pass through to the 3D scene */
            display: flex; flex-direction: column; justify-content: space-between;
        }

        /* TOP HEADER */
        #header {
            background: rgba(0,0,0,0.6); color: #f1c40f; 
            padding: 15px; text-align: center; font-family: 'Cinzel', serif;
            pointer-events: auto;
        }

        /* BOTTOM CONTROLS */
        #footer {
            padding: 20px; text-align: center; pointer-events: auto;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
        }

        /* SELECTION BUTTONS */
        .char-btn {
            background: white; border: 3px solid #f1c40f; border-radius: 50%;
            width: 60px; height: 60px; margin: 0 10px; cursor: pointer;
            overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transition: transform 0.2s;
        }
        .char-btn.selected { transform: scale(1.2); border-color: #3498db; }
        .char-btn img { width: 100%; height: 100%; object-fit: cover; }

        /* AR INSTRUCTION HINT */
        #reticle-hint {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; font-family: 'Lato', sans-serif; font-weight: bold;
            text-shadow: 1px 1px 2px black; text-align: center; display: none;
        }

        /* INFO CARD (Pop up) */
        #info-card {
            position: absolute; top: 100px; left: 50%; transform: translateX(-50%);
            width: 80%; background: rgba(255,255,255,0.95); 
            border: 2px solid #f1c40f; border-radius: 10px; padding: 20px;
            display: none; pointer-events: auto; text-align: center;
        }
    </style>
</head>

<body>
    
    <div id="overlay">
        <div id="header">
            <h2 style="margin:0;">Malaysian Architects</h2>
        </div>

        <div id="reticle-hint">
            Point at floor &<br>move phone slowly...
        </div>

        <div id="info-card">
            <h3 id="info-title" style="margin-top:0; font-family:'Cinzel',serif;">Title</h3>
            <p id="info-desc">Description</p>
            <button onclick="document.getElementById('info-card').style.display='none'" style="background:#e74c3c; color:white; border:none; padding:8px 20px;">CLOSE</button>
        </div>

        <div id="footer">
            <p style="color:white; margin-bottom:10px; font-size:14px;">SELECT ARCHITECT & TAP FLOOR</p>
            <div style="display:flex; justify-content:center;">
                <button class="char-btn selected" onclick="selectChar('hubback', this)">
                    <img src="./assets/hubback.png" onerror="this.src='https://via.placeholder.com/100?text=H'">
                </button>
                <button class="char-btn" onclick="selectChar('norman', this)">
                    <img src="./assets/norman.png" onerror="this.src='https://via.placeholder.com/100?text=N'">
                </button>
            </div>
        </div>
    </div>

    <a-scene 
        webxr="optionalFeatures: hit-test, dom-overlay; overlayElement: #overlay" 
        ar-hit-test="target: #spawner; type: map;"
        renderer="colorManagement: true; physicallyCorrectLights: true;"
        vr-mode-ui="enabled: false">
        
        <a-assets>
            <img id="img-hubback" src="./assets/hubback.png">
            <img id="img-norman" src="./assets/norman.png">
        </a-assets>

        <a-light type="directional" intensity="1" position="-1 3 2"></a-light>
        <a-light type="ambient" intensity="0.8"></a-light>

        <a-entity id="spawner" position="0 -100 0" visible="false">
            
            <a-entity id="architect-model" position="0 0 0" scale="1 1 1">
                
                <a-box position="0 0.75 0" height="1.5" width="1" depth="0.05" color="#2c3e50"></a-box>
                <a-box position="0 0 0" height="0.05" width="1.2" depth="0.5" color="#f1c40f"></a-box>

                <a-image id="ar-photo" src="#img-hubback" position="0 0.9 0.03" width="0.8" height="1"></a-image>

                <a-text id="ar-text" value="A.B. HUBBACK" align="center" position="0 1.6 0.03" color="#f1c40f" width="4" font="mozillavr"></a-text>

                <a-entity position="0 0.4 0.1">
                    <a-box class="clickable" color="#3498db" width="0.8" height="0.15" depth="0.02" position="0 0.1 0"
                           onclick="showInfo('bg')"></a-box>
                    <a-text value="BACKGROUND" align="center" position="0 0.1 0.02" width="2"></a-text>

                    <a-box class="clickable" color="#3498db" width="0.8" height="0.15" depth="0.02" position="0 -0.1 0"
                           onclick="showInfo('con')"></a-box>
                    <a-text value="CONTRIBUTION" align="center" position="0 -0.1 0.02" width="2"></a-text>
                </a-entity>

            </a-entity>
        </a-entity>
        
        <a-entity id="reticle" visible="false">
            <a-ring color="#f1c40f" radius-inner="0.15" radius-outer="0.2" rotation="-90 0 0"></a-ring>
            <a-circle color="#f1c40f" radius="0.05" rotation="-90 0 0"></a-circle>
        </a-entity>

    </a-scene>

    <script>
        // DATABASE
        const db = {
            hubback: { name: "A.B. HUBBACK", img: "#img-hubback", bg: "British architect who designed Jamek Mosque.", con: "Pioneered Indo-Saracenic style in Malaya." },
            norman: { name: "A.C. NORMAN", img: "#img-norman", bg: "Government Architect of Selangor.", con: "Ground plans for Sultan Abdul Samad Building." }
        };
        
        let currentId = 'hubback';
        let isPlaced = false;

        // --- 1. HANDLE CHARACTER SELECTION ---
        window.selectChar = function(id, btn) {
            // UI Update
            document.querySelectorAll('.char-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            
            currentId = id;
            
            // Update 3D Model immediately
            document.getElementById('ar-photo').setAttribute('src', db[id].img);
            document.getElementById('ar-text').setAttribute('value', db[id].name);
        };

        // --- 2. HANDLE AR PLACEMENT ---
        // A-Frame's 'ar-hit-test' component fires 'ar-hit-test-select' when you tap the screen while the reticle is visible.
        const scene = document.querySelector('a-scene');
        const spawner = document.getElementById('spawner');
        const reticle = document.getElementById('reticle');
        const hint = document.getElementById('reticle-hint');

        scene.addEventListener('enter-vr', () => {
            if (scene.is('ar-mode')) {
                hint.style.display = 'block';
            }
        });

        // Event: Reticle found a surface
        scene.addEventListener('ar-hit-test-start', () => { 
            hint.innerHTML = "Surface found!<br>Tap to place.";
            reticle.setAttribute('visible', 'true');
        });

        // Event: User Tapped to Place
        scene.addEventListener('ar-hit-test-select', () => {
            if(!isPlaced) {
                spawner.setAttribute('visible', 'true');
                reticle.setAttribute('visible', 'false'); // Hide ring
                hint.style.display = 'none'; // Hide text
                
                // Un-hide the model
                document.getElementById('architect-model').setAttribute('visible', 'true');
                
                isPlaced = true;
            }
        });
        
        // --- 3. HANDLE INFO POPUPS ---
        window.showInfo = function(type) {
            const data = db[currentId];
            const card = document.getElementById('info-card');
            card.style.display = 'block';
            
            if(type === 'bg') {
                document.getElementById('info-title').innerText = "Background";
                document.getElementById('info-desc').innerText = data.bg;
            } else {
                document.getElementById('info-title').innerText = "Contribution";
                document.getElementById('info-desc').innerText = data.con;
            }
        }

    </script>
</body>
</html>