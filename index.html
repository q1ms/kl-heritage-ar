<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>The Life of Malaysia's Historical Figures</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Lato:wght@400;700&display=swap" rel="stylesheet">

    <style>
      body { margin: 0; font-family: 'Lato', sans-serif; overflow: hidden; background: #2c3e50; }
      
      /* UTILITIES */
      .hidden { display: none !important; }
      .fade-in { animation: fadeIn 0.5s; }
      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

      /* SCREEN 1: TITLE */
      #title-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(135deg, #1a1a2e 0%, #0f1526 100%);
        z-index: 3000; display: flex; flex-direction: column;
        justify-content: center; align-items: center; color: #f1c40f; text-align: center;
      }
      .start-btn {
        background: #f1c40f; color: #1a1a2e; border: none; padding: 15px 40px;
        font-family: 'Cinzel', serif; font-size: 20px; border-radius: 30px; margin-top: 20px;
        cursor: pointer; box-shadow: 0 0 15px rgba(241, 196, 15, 0.5);
      }

      /* SCREEN 2: CAROUSEL SELECTION */
      #selection-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #2c3e50; z-index: 2500; display: none;
        flex-direction: column; justify-content: center; align-items: center;
      }
      .carousel-container { position: relative; width: 100%; height: 70%; display: flex; justify-content: center; align-items: center; }
      .carousel-card {
        background: white; width: 260px; padding: 20px; border-radius: 20px;
        text-align: center; border: 4px solid #f1c40f;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        display: none; flex-direction: column; align-items: center;
      }
      .carousel-card.active { display: flex; } 
      .carousel-card img { width: 100%; height: 200px; object-fit: cover; border-radius: 10px; margin-bottom: 15px; border: 2px solid #eee; }
      .carousel-card h3 { font-family: 'Cinzel', serif; font-size: 22px; color: #1a1a2e; margin: 0 0 10px 0; }
      .select-btn { background: #1a1a2e; color: #f1c40f; border: none; padding: 10px 30px; border-radius: 20px; font-weight: bold; cursor: pointer; margin-top: 10px; }
      .nav-btn {
        position: absolute; top: 50%; transform: translateY(-50%);
        background: rgba(241, 196, 15, 0.8); color: #1a1a2e; width: 50px; height: 50px;
        border-radius: 50%; border: none; font-size: 24px; font-weight: bold; cursor: pointer; z-index: 10;
        display: flex; justify-content: center; align-items: center;
      }
      .prev-btn { left: 20px; }
      .next-btn { right: 20px; }

      /* HOLOGRAPHIC INFO PANEL (The Glass Overlay for Text) */
      #holo-panel {
        position: fixed; top: 10%; left: 5%; width: 90%; height: 80%;
        background: rgba(16, 21, 30, 0.9); border: 2px solid #f1c40f;
        border-radius: 15px; color: #ecf0f1; padding: 20px; box-sizing: border-box;
        display: none; flex-direction: column; z-index: 2200;
        backdrop-filter: blur(5px); box-shadow: 0 0 30px rgba(241, 196, 15, 0.3);
      }
      #holo-content { overflow-y: auto; text-align: justify; line-height: 1.6; font-size: 16px; flex-grow: 1; margin-top:10px; }
      .holo-close {
        align-self: flex-end; background: #e74c3c; color: white; border: none;
        padding: 8px 20px; border-radius: 5px; cursor: pointer; font-weight:bold;
      }

      /* GAME HUD */
      #ar-hud { position: absolute; bottom: 20px; width: 100%; text-align: center; z-index: 1000; display: none; }
      .hud-box { background: rgba(0,0,0,0.85); color: white; padding: 15px; border-radius: 15px; display: inline-block; width: 90%; }
      #game-controls { display: none; margin-top: 10px; }
      .hud-btn { background: white; border: none; padding: 10px 20px; border-radius: 20px; margin: 5px; font-weight: bold; }

      /* QUIZ & VICTORY */
      #quiz-screen {
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        width: 85%; background: white; border: 4px solid #1a1a2e; border-radius: 15px;
        padding: 20px; text-align: center; z-index: 4000; display: none;
        box-shadow: 0 0 50px rgba(0,0,0,0.5);
      }
      .quiz-option { display: block; width: 100%; padding: 12px; margin: 10px 0; background: #ecf0f1; border: none; border-radius: 8px; cursor:pointer; }
      #victory-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(39, 174, 96, 0.98); z-index: 5000; display: none;
        flex-direction: column; justify-content: center; align-items: center; color: white;
      }
      
      /* Back Button for AR Mode */
      #ar-back-btn {
        position: fixed; top: 20px; left: 20px; z-index: 2000; display: none;
        background: rgba(0,0,0,0.5); color: white; border: none;
        padding: 10px 15px; border-radius: 50%; font-size: 20px; cursor:pointer;
      }
    </style>
  </head>

  <body>

    <div id="title-screen">
      <h1 style="font-family:'Cinzel',serif; font-size:32px; padding:0 20px;">The Life of Malaysia's Historical Figures</h1>
      <button class="start-btn" onclick="goToSelection()">ENTER MUSEUM</button>
    </div>

    <div id="selection-screen">
      <h2 style="color:white; font-family:'Cinzel',serif; margin-bottom:10px;">Select Figure</h2>
      <div class="carousel-container">
        <button class="nav-btn prev-btn" onclick="moveSlide(-1)">&#10094;</button>
        <button class="nav-btn next-btn" onclick="moveSlide(1)">&#10095;</button>
        
        <div class="carousel-card active fade-in" id="card-0">
          <img src="./assets/hubback.png" onerror="this.src='https://via.placeholder.com/200?text=Hubback'">
          <h3>A.B. Hubback</h3>
          <button class="select-btn" onclick="openARProfile('hubback')">SELECT</button>
        </div>
        <div class="carousel-card fade-in" id="card-1">
          <img src="./assets/norman.png" onerror="this.src='https://via.placeholder.com/200?text=Norman'">
          <h3>A.C. Norman</h3>
          <button class="select-btn" onclick="openARProfile('norman')">SELECT</button>
        </div>
        <div class="carousel-card fade-in" id="card-2">
          <img src="./assets/bidwell.png" onerror="this.src='https://via.placeholder.com/200?text=Bidwell'">
          <h3>R.A.J Bidwell</h3>
          <button class="select-btn" onclick="openARProfile('bidwell')">SELECT</button>
        </div>
        <div class="carousel-card fade-in" id="card-3">
          <img src="./assets/spooner.png" onerror="this.src='https://via.placeholder.com/200?text=Spooner'">
          <h3>Charles Spooner</h3>
          <button class="select-btn" onclick="openARProfile('spooner')">SELECT</button>
        </div>
        <div class="carousel-card fade-in" id="card-4">
          <img src="./assets/jewkes.png" onerror="this.src='https://via.placeholder.com/200?text=Jewkes'">
          <h3>Stanley Jewkes</h3>
          <button class="select-btn" onclick="openARProfile('jewkes')">SELECT</button>
        </div>
        <div class="carousel-card fade-in" id="card-5">
          <img src="./assets/baharuddin.png" onerror="this.src='https://via.placeholder.com/200?text=Baharuddin'">
          <h3>Datuk Baharuddin</h3>
          <button class="select-btn" onclick="openARProfile('baharuddin')">SELECT</button>
        </div>
      </div>
    </div>
    
    <button id="ar-back-btn" onclick="goBackToMenu()">&#8592;</button>

    <div id="holo-panel">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 id="holo-title" style="margin:0; font-family:'Cinzel',serif; color:#f1c40f;">Title</h2>
        <button class="holo-close" onclick="closeHolo()">CLOSE</button>
      </div>
      <div id="holo-content">Text...</div>
    </div>

    <div id="ar-hud">
      <div class="hud-box">
        <h3 id="ar-task-title" style="margin-top:0; color:#f1c40f;">Searching...</h3>
        <p id="ar-task-desc">Scan the poster to begin.</p>
        <div id="game-controls">
          <button class="hud-btn" onclick="alert('Incorrect style!')">Option A</button>
          <button class="hud-btn" style="background:#2ecc71; color:white;" onclick="finishGame()">Option B</button>
        </div>
      </div>
    </div>

    <div id="quiz-screen">
      <h3 style="color:#1a1a2e; font-family:'Cinzel',serif;">History Quiz</h3>
      <p id="quiz-question" style="font-weight:bold; margin-bottom:20px;">Question goes here...</p>
      <div id="quiz-options-container"></div>
    </div>

    <div id="victory-screen">
      <h1 style="font-family:'Cinzel',serif; font-size:40px;">CORRECT!</h1>
      <button class="start-btn" style="background:white; color:#27ae60;" onclick="location.reload()">Back to Menu</button>
    </div>

    <a-scene mindar-image="imageTargetSrc: ./assets/targets.mind;" 
             cursor="rayOrigin: mouse" 
             raycaster="objects: .clickable" 
             vr-mode-ui="enabled: false" 
             device-orientation-permission-ui="enabled: false">

      <a-assets>
         <img id="btn-bg-texture" src="https://upload.wikimedia.org/wikipedia/commons/4/48/Dark_Blue_gradient_background.jpg"> 
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false">
        
        <a-entity id="ar-menu-group" position="0 0 -1.5" visible="false">
          
          <a-image id="ar-3d-portrait" position="-0.3 0 0" width="0.5" height="0.6" src="" 
                   animation="property: position; to: -0.3 0.05 0; dir: alternate; dur: 2000; loop: true"></a-image>

          <a-plane class="clickable" position="0.3 0.2 0" width="0.55" height="0.15" color="#1a1a2e" opacity="0.9"
                   id="btn-3d-bg"
                   animation="property: scale; to: 1.05 1.05 1; dir: alternate; dur: 1500; loop: true">
             <a-text value="Background" align="center" color="#f1c40f" width="2"></a-text>
          </a-plane>

          <a-plane class="clickable" position="0.3 0 0" width="0.55" height="0.15" color="#1a1a2e" opacity="0.9"
                   id="btn-3d-con">
             <a-text value="Contribution" align="center" color="#f1c40f" width="2"></a-text>
          </a-plane>

          <a-plane class="clickable" position="0.3 -0.2 0" width="0.55" height="0.15" color="#f1c40f" opacity="0.9"
                   id="btn-3d-build">
             <a-text value="BUILD STRUCTURE >" align="center" color="#1a1a2e" width="1.8" font="sourcecodepro"></a-text>
          </a-plane>

        </a-entity>
      </a-camera>

      <a-entity mindar-image-target="targetIndex: 0" id="target-entity">
        <a-cylinder position="0 0 0" radius="0.4" height="0.8" color="#8B4513"></a-cylinder>
        <a-box position="0 0.4 0" width="0.6" depth="0.6" height="0.1" color="#555"></a-box>
        <a-sphere id="ar-object" position="0 0.8 0" radius="0.35" color="#FFD700" visible="false"></a-sphere>
      </a-entity>

    </a-scene>

    <script>
      // --- DATABASE ---
      const db = {
        hubback: {
          name: "Arthur Benison Hubback", img: "./assets/hubback.png",
          bg: "Born on 13 April 1871 in Liverpool, England, Arthur Benison Hubback was a distinguished British Army officer and architect. After completing his architectural training in Liverpool, he arrived in Malaya in 1895. He quickly rose through the ranks, becoming the chief government architect of the Federated Malay States by 1900. Uniquely, Hubback was also a dedicated soldier. Unlike many of his contemporaries, he paused his architectural career to serve in World War I, commanding troops in France and eventually reaching the rank of Brigadier General. He remained in the army until his retirement in 1924, leaving a legacy of discipline and artistry.",
          con: "Hubback is celebrated for defining the architectural identity of British Malaya through the 'Indo-Saracenic' style. His masterpieces include the Jamek Mosque (1909), the Kuala Lumpur Railway Station (1910), and the National Textile Museum. Under the direction of Charles Edwin Spooner, Hubback moved away from traditional European styles to incorporate Mughal elements like onion domes, chatris, and horse-shoe arches. This fusion style became the visual symbol of the colonial administration's respect for Islamic culture. His buildings were not just functional; they were grand statements of state power dressed in elegant, oriental attire.",
          task: { title: "Jamek Mosque", desc: "Spooner demands an Indo-Saracenic roof. Choose it!" },
          quiz: { q: "Hubback commanded troops in which war?", options: ["World War II", "World War I", "Boer War"], correct: 1 }
        },
        norman: {
          name: "A.C. Norman", img: "./assets/norman.png",
          bg: "Arthur Charles Alfred Norman (1858-1944) was a British architect who played a foundational role in the development of Kuala Lumpur. He arrived in Selangor in 1883, working initially as an Assistant Superintendent before becoming the Government Architect in 1890. He served until 1903, a period of rapid transformation for the city. Although his tenure ended with a compulsory retirement on grounds of 'inefficiency' at age 45, his early contributions laid the groundwork for the capital's historic core. He later returned to England, continuing his practice in Norwich and Plymouth.",
          con: "Norman is credited with the ground plan of the iconic Sultan Abdul Samad Building, although the elevation was later reworked by Bidwell. His other significant contributions include the St. Mary's Church (1894), Pudu Prison (1895), and the original Selangor Club. Norman's style was eclectic; he introduced the 'blood and bandage' style of exposed brickwork combined with plaster. While his initial designs for the government offices were in a Classic Renaissance style (which was rejected), his structural planning enabled the creation of the grand historic buildings we see around Dataran Merdeka today.",
          task: { title: "Sultan Abdul Samad", desc: "Norman drew the floor plan. Now add the roof!" },
          quiz: { q: "Which building's ground plan is credited to Norman?", options: ["National Mosque", "Sultan Abdul Samad Building", "Stadium Merdeka"], correct: 1 }
        },
        bidwell: {
          name: "R.A.J Bidwell", img: "./assets/bidwell.png",
          bg: "Regent Alfred John Bidwell (1869-1918) was a talented architect born in South London. He received his training with Lockyer, Son, & Cox in London and was a member of the Architectural Association. In 1893, he moved to Malaya to work for the Selangor Public Works Department (PWD). Bidwell was known for his artistic flair and ability to adapt to changing demands. He was the unsung hero behind many of Kuala Lumpur's most famous facades, often working under the shadow of his superiors like Norman and Spooner.",
          con: "Bidwell's most significant contribution was the visual design of the Sultan Abdul Samad Building. Originally, he designed the elevation in a Classic Renaissance style. However, the State Engineer, Charles Edwin Spooner, rejected this look, demanding something 'Mahometan' (Islamic) to suit the local culture. Bidwell displayed immense versatility by completely reworking the design into the Neo-Mughal (Indo-Saracenic) masterpiece that stands today. He successfully integrated onion domes and arched colonnades on top of Norman's floor plan, effectively introducing the onion dome to the Malayan architectural vocabulary.",
          task: { title: "Change the Style", desc: "Spooner rejected Renaissance. Switch to Indo-Saracenic!" },
          quiz: { q: "Who instructed Bidwell to rework the design?", options: ["Hubback", "Spooner", "Swettenham"], correct: 1 }
        },
        spooner: {
          name: "Charles Edwin Spooner", img: "./assets/spooner.png",
          bg: "Charles Edwin Spooner (1853-1909) was a British engineer born in North Wales. Educated at Trinity College, Dublin, he was a man of vision and authority. As the State Engineer of the Selangor Public Works Department and later the General Manager of the Federated Malay States Railways, Spooner held the power to shape the entire physical landscape of Kuala Lumpur. He was known for his ambitious building programs and his decisive nature, often overruling architects to ensure buildings met his specific aesthetic and functional vision.",
          con: "Spooner was the mastermind behind the adoption of the 'Islamic' style for Kuala Lumpur's government buildings. He famously rejected the Western Classic Renaissance designs for the Sultan Abdul Samad Building, insisting instead on a style he described as 'Mahometan' to reflect the local religion and climate. This decision changed the course of Malaysian architectural history, leading to the construction of the KL Railway Station and Jamek Mosque in similar styles. He also reorganized the railway system, creating the backbone of the nation's transport infrastructure.",
          task: { title: "State Engineer's Order", desc: "I want an Islamic Style roof. Build it!" },
          quiz: { q: "Spooner described the new architectural style as:", options: ["Gothic", "Modernist", "Islamic/Mahometan"], correct: 2 }
        },
        jewkes: {
          name: "Stanley Edward Jewkes", img: "./assets/jewkes.png",
          bg: "Stanley Edward Jewkes (1913-2011) was an American-born architect and engineer who became a key figure in Malaysia's post-war development. He joined the Public Works Department in 1941 and served through the turbulent years of World War II and the Emergency. Jewkes rose to become the Director of the PWD from 1959 to 1962. He shared a close professional relationship with Malaysia's first Prime Minister, Tunku Abdul Rahman, who trusted him with projects of immense national importance.",
          con: "Jewkes' crowning achievement is the design and construction of Stadium Merdeka (Independence Stadium). He was tasked with building this historic venue in time for the formal declaration of independence on August 31, 1957. Under immense pressure, he designed a stadium that was not only an engineering marvel of its time—with the world's tallest prestressed concrete floodlight towers—but also a symbol of the new nation's hopes. He also designed Stadium Negara and the Klang Gates Dam, contributing significantly to the modern infrastructure of Kuala Lumpur.",
          task: { title: "Stadium Merdeka", desc: "Build the site for Independence Day!" },
          quiz: { q: "What historic event happened at Stadium Merdeka?", options: ["Commonwealth Games", "Declaration of Independence", "Malaysia Day"], correct: 1 }
        },
        baharuddin: {
          name: "Datuk Baharuddin Abu Kassim", img: "./assets/baharuddin.png",
          bg: "Born in 1929, Datuk Baharuddin Abu Kassim is a pioneering Malay architect who played a crucial role in shaping the identity of post-independence Malaysia. He studied at the Manchester University School of Architecture and returned to serve in the Public Works Department (JKR). As one of the first qualified Malay architects, he sought to create a modern architectural language that respected traditional Malay culture and Islam while embracing progressive, democratic values.",
          con: "Baharuddin is best known as the chief architect of the National Mosque (Masjid Negara). Breaking away from the colonial Indo-Saracenic domes, he introduced a modernist approach. His design features a unique 16-pointed star concrete main roof, resembling an open umbrella, and a 73-meter minaret that looks like a folded umbrella. This 'Umbrella' concept was chosen to represent the tropics and the protection of the King (whose symbol is the yellow umbrella). Completed in 1965, the mosque stands as a bold icon of Malaysia's modern identity.",
          task: { title: "National Mosque", desc: "Construct the 'Umbrella Dome'!" },
          quiz: { q: "What does the National Mosque's main dome resemble?", options: ["A Pyramid", "An Onion", "A Semi-opened Umbrella"], correct: 2 }
        }
      };

      let currentData = null;
      let slideIndex = 0;
      const totalSlides = 6;

      // --- LOGIC ---
      function goToSelection() {
        document.getElementById('title-screen').style.display = 'none';
        document.getElementById('selection-screen').style.display = 'flex';
      }

      function moveSlide(n) {
        document.getElementById('card-' + slideIndex).classList.remove('active');
        slideIndex += n;
        if (slideIndex >= totalSlides) slideIndex = 0;
        if (slideIndex < 0) slideIndex = totalSlides - 1;
        document.getElementById('card-' + slideIndex).classList.add('active');
      }

      // --- ACTIVATE 3D AR PROFILE ---
      function openARProfile(id) {
        currentData = db[id];
        
        // 1. Hide HTML Menus
        document.getElementById('selection-screen').style.display = 'none';
        document.getElementById('ar-back-btn').style.display = 'block';

        // 2. Update the 3D Object Textures
        // Note: A-Frame image src requires the path directly
        const portrait = document.querySelector('#ar-3d-portrait');
        portrait.setAttribute('src', currentData.img);
        
        // 3. Make the 3D Menu Visible
        document.querySelector('#ar-menu-group').setAttribute('visible', 'true');
      }

      function goBackToMenu() {
        document.querySelector('#ar-menu-group').setAttribute('visible', 'false');
        document.getElementById('ar-back-btn').style.display = 'none';
        document.getElementById('selection-screen').style.display = 'flex';
        closeHolo();
      }

      // --- 3D BUTTON LISTENERS ---
      // We add event listeners to the 3D objects
      
      document.querySelector('#btn-3d-bg').addEventListener('click', function (evt) {
        showHolo('bg');
      });

      document.querySelector('#btn-3d-con').addEventListener('click', function (evt) {
        showHolo('con');
      });

      document.querySelector('#btn-3d-build').addEventListener('click', function (evt) {
        startBuildingTask();
      });

      // --- HOLOGRAPHIC INFO PANELS ---
      function showHolo(type) {
        const panel = document.getElementById('holo-panel');
        const title = document.getElementById('holo-title');
        const content = document.getElementById('holo-content');
        
        panel.style.display = 'flex';
        if (type === 'bg') {
          title.innerText = "Background History";
          content.innerText = currentData.bg;
        } else {
          title.innerText = "Contribution";
          content.innerText = currentData.con;
        }
      }

      function closeHolo() {
        document.getElementById('holo-panel').style.display = 'none';
      }

      // --- START GAME TASK ---
      function startBuildingTask() {
        // 1. Hide the Floating Menu
        document.querySelector('#ar-menu-group').setAttribute('visible', 'false');
        document.getElementById('ar-back-btn').style.display = 'none';
        
        // 2. Show the Game HUD
        const hud = document.getElementById('ar-hud');
        hud.style.display = 'block';
        document.getElementById('ar-task-title').innerText = "Scanning...";
        document.getElementById('ar-task-desc').innerText = "Point camera at the poster.";
        
        // 3. Setup Listener for Poster
        const target = document.querySelector('#target-entity');
        
        target.addEventListener("targetFound", () => {
          document.getElementById('ar-task-title').innerText = currentData.task.title;
          document.getElementById('ar-task-desc').innerText = currentData.task.desc;
          document.getElementById('game-controls').style.display = 'block';
        });

        target.addEventListener("targetLost", () => {
          document.getElementById('ar-task-title').innerText = "Scanning...";
          document.getElementById('ar-task-desc').innerText = "Point camera at the poster.";
          document.getElementById('game-controls').style.display = 'none';
        });
      }

      function finishGame() {
        document.getElementById('ar-object').setAttribute('visible', 'true');
        document.getElementById('ar-hud').style.display = 'none';
        setTimeout(() => { setupQuiz(); }, 1500);
      }

      function setupQuiz() {
        document.getElementById('quiz-screen').style.display = 'block';
        document.getElementById('quiz-question').innerText = currentData.quiz.q;
        const container = document.getElementById('quiz-options-container');
        container.innerHTML = "";
        
        currentData.quiz.options.forEach((opt, index) => {
          let btn = document.createElement("button");
          btn.className = "quiz-option";
          btn.innerText = opt;
          btn.onclick = () => {
            if(index === currentData.quiz.correct) {
              document.getElementById('quiz-screen').style.display = 'none';
              document.getElementById('victory-screen').style.display = 'flex';
            } else {
              alert("Incorrect!");
            }
          };
          container.appendChild(btn);
        });
      }
    </script>
  </body>
</html>