<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
      body { margin: 0; font-family: 'Courier New', sans-serif; overflow: hidden; }

      /* --- SCREEN 1: THE START MENU (From PDF Page 1) --- */
      #start-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #2c3e50;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
      }
      .character-card {
        background: white; color: black;
        padding: 20px; margin: 10px; border-radius: 15px;
        width: 200px; text-align: center;
        cursor: pointer; border: 4px solid #f1c40f;
      }

      /* --- SCREEN 2: THE AR GAME UI (From PDF Page 1 "Contribution") --- */
      #game-ui {
        position: absolute; bottom: 20px; left: 0; width: 100%;
        text-align: center; z-index: 500;
        display: none; /* Hidden until game starts */
      }
      .game-btn {
        background: #e74c3c; color: white; border: none;
        padding: 10px 20px; font-size: 16px; border-radius: 20px; margin: 5px;
      }

      /* --- SCREEN 3: THE QUIZ (From PDF Page 2) --- */
      #quiz-screen {
        position: fixed; top: 20%; left: 10%; width: 80%;
        background: white; border: 4px solid #333; border-radius: 20px;
        padding: 20px; text-align: center; z-index: 2000;
        display: none; /* Hidden until triggered */
        box-shadow: 0 10px 20px rgba(0,0,0,0.5);
      }
      .quiz-btn {
        display: block; width: 90%; margin: 10px auto;
        padding: 10px; background: #3498db; color: white;
        border: none; border-radius: 10px; font-size: 16px;
      }

      /* --- SCREEN 4: VICTORY (From PDF Page 2 "You're Correct!") --- */
      #victory-screen {
        position: fixed; top: 30%; left: 10%; width: 80%;
        background: #2ecc71; color: white;
        border: 4px solid white; border-radius: 20px;
        padding: 20px; text-align: center; z-index: 3000;
        display: none;
      }
    </style>
  </head>

  <body>

    <div id="start-screen">
      <h1>HISTORICAL FIGURES</h1>
      <p>Select a Mission:</p>
      
      <div class="character-card" onclick="startGame()">
        <h3>The Architect</h3>
        <p>A.B. Hubback</p>
        <small>(Tap to Start)</small>
      </div>
    </div>

    <div id="game-ui">
      <div style="background:rgba(0,0,0,0.7); color:white; padding:10px; display:inline-block; border-radius:10px;">
        <p>Challenge: Fix the Roof Design!</p>
        <button class="game-btn" onclick="wrongMove()">Gothic Spire</button>
        <button class="game-btn" onclick="finishBuilding()">Onion Dome</button>
      </div>
    </div>

    <div id="quiz-screen">
      <h2>Quick Quiz!</h2>
      <p>What style did Spooner demand for this building?</p>
      <button class="quiz-btn" onclick="checkQuiz(false)">A) Tudor Style</button>
      <button class="quiz-btn" onclick="checkQuiz(true)">B) Indo-Saracenic</button>
      <button class="quiz-btn" onclick="checkQuiz(false)">C) Modernist</button>
    </div>

    <div id="victory-screen">
      <h1>You're Correct!</h1>
      <div style="margin-top:20px;">
        <button style="padding:10px;" onclick="location.reload()">üè† Main Menu</button>
        <button style="padding:10px;" onclick="alert('Next Level Coming Soon!')">Next ‚û°</button>
      </div>
    </div>

    <a-scene mindar-image="imageTargetSrc: ./assets/targets.mind;" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-entity mindar-image-target="targetIndex: 0" id="target-entity">
        <a-cylinder position="0 0 0" radius="0.3" height="1" color="#8B4513"></a-cylinder>
        <a-torus position="0 0 0.3" radius="0.1" radius-tubular="0.02" arc="180" rotation="0 0 0" color="white"></a-torus>
        <a-sphere id="onion-dome" position="0 0.5 0" radius="0.32" color="#FFD700" visible="false"></a-sphere>
      </a-entity>
    </a-scene>

    <script>
      // --- Variables ---
      const startScreen = document.getElementById('start-screen');
      const gameUI = document.getElementById('game-ui');
      const quizScreen = document.getElementById('quiz-screen');
      const victoryScreen = document.getElementById('victory-screen');
      const dome = document.getElementById('onion-dome');
      const arTarget = document.getElementById('target-entity');

      let gameStarted = false;

      // 1. Function to Start the Game (Hide Menu)
      function startGame() {
        startScreen.style.display = 'none'; // Hide menu
        alert("Point camera at your image to begin!");
        gameStarted = true;
      }

      // 2. Show Game Controls ONLY when image is found AND game has started
      arTarget.addEventListener("targetFound", event => {
        if(gameStarted) {
          gameUI.style.display = 'block';
        }
      });
      arTarget.addEventListener("targetLost", event => {
        gameUI.style.display = 'none';
      });

      // 3. Game Logic: Building the Dome
      function wrongMove() {
        alert("Spooner rejected this design! Try again.");
      }

      function finishBuilding() {
        // Show the dome
        dome.setAttribute('visible', 'true');
        
        // Hide the building buttons
        gameUI.style.display = 'none';

        // Wait 1 second, then show the Quiz (Storyline Flow)
        setTimeout(() => {
          quizScreen.style.display = 'block'; // Show Page 2 Quiz
        }, 1000);
      }

      // 4. Quiz Logic
      function checkQuiz(isCorrect) {
        if(isCorrect) {
          quizScreen.style.display = 'none';
          victoryScreen.style.display = 'block'; // Show "You're Correct"
        } else {
          alert("Incorrect. Try again!");
        }
      }
    </script>
  </body>
</html>