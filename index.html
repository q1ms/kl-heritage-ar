<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Bulletproof Test</title>

    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; background: #222; color: white; }
        
        /* UI LAYOUT */
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; background: #222; }
        .hidden { display: none !important; }
        
        /* BUTTONS */
        .btn { padding: 15px 30px; margin: 10px; border-radius: 30px; border: none; font-weight: bold; cursor: pointer; font-size: 16px; }
        .btn-yellow { background: #f1c40f; color: black; }
        .btn-red { background: #e74c3c; color: white; }
        
        /* SCAN OVERLAY */
        #scan-ui { pointer-events: none; position: absolute; bottom: 20px; width: 100%; text-align: center; z-index: 20; display: none; }
        #scan-ui button { pointer-events: auto; }
    </style>
</head>
<body>

    <div id="menu-screen" class="screen">
        <h1>AR TEST MODE</h1>
        <p>Select a Virtual Model:</p>
        <button class="btn btn-yellow" onclick="startAR('box')">OPTION A: RED BOX</button>
        <button class="btn btn-yellow" onclick="startAR('sphere')">OPTION B: BLUE SPHERE</button>
    </div>

    <div id="scan-ui">
        <div style="background:rgba(0,0,0,0.5); color:white; padding:10px; display:inline-block; margin-bottom:10px; border-radius:10px;">
            Point Camera at KING OF SPADES
        </div>
        <br>
        <button class="btn btn-red" onclick="stopAR()">STOP SCANNING</button>
    </div>

    <a-scene 
        mindar-image="imageTargetSrc: https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.2/examples/image-tracking/assets/card-example/card.mind; autoStart: false; uiLoading: yes; uiScanning: yes;" 
        embedded 
        color-space="sRGB" 
        renderer="colorManagement: true, physicallyCorrectLights" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false">
        
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            
            <a-box id="model-box" position="0 0 0" scale="0.5 0.5 0.5" color="red" visible="false" animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"></a-box>
            
            <a-sphere id="model-sphere" position="0 0 0" radius="0.3" color="blue" visible="false" animation="property: position; to: 0 0.5 0; dir: alternate; loop: true; dur: 1000"></a-sphere>

        </a-entity>
    </a-scene>

    <script>
        const sceneEl = document.querySelector('a-scene');
        const arSystem = sceneEl.systems['mindar-image-system'];
        
        // --- START AR ---
        function startAR(modelType) {
            // 1. Hide Menu
            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('scan-ui').style.display = 'block';
            
            // 2. Select Which Model to Show
            const box = document.getElementById('model-box');
            const sphere = document.getElementById('model-sphere');
            
            // Reset both to hidden first
            box.setAttribute('visible', 'false');
            sphere.setAttribute('visible', 'false');

            // Show selected
            if(modelType === 'box') box.setAttribute('visible', 'true');
            if(modelType === 'sphere') sphere.setAttribute('visible', 'true');

            // 3. Make background transparent so we see camera
            document.body.style.backgroundColor = 'transparent';
            document.getElementById('menu-screen').style.background = 'transparent';

            // 4. Start Engine
            sceneEl.addEventListener('loaded', () => {
                 // Safety check if user clicks extremely fast
                 sceneEl.systems['mindar-image-system'].start();
            });
            
            // If already loaded, start immediately
            if(sceneEl.hasLoaded) {
                sceneEl.systems['mindar-image-system'].start();
            }
        }

        // --- STOP AR ---
        function stopAR() {
            sceneEl.systems['mindar-image-system'].stop();
            
            // Restore UI
            document.getElementById('scan-ui').style.display = 'none';
            document.getElementById('menu-screen').classList.remove('hidden');
            
            // Restore Background
            document.body.style.backgroundColor = '#222';
            document.getElementById('menu-screen').style.background = '#222';
        }
    </script>
</body>
</html>